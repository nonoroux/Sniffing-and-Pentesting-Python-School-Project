"""
Script de scan de réseau tiré de https://null-byte.wonderhowto.com/how-to/build-arp-scanner-using-scapy-and-python-0162731/
et modifié aux besoins de mon programme
"""
from libs.scapy.all import *

def netDevScan(iface="eth0", iprange="172.22.22.0/24"):
    """
	Arg : iface, l'interface; iprange, la range d'ip
    Action : Effectue in scan réseau sur l'interface iface et la range d'ip iprange et
			 renvoie une liste lstDev qui contient les couples MAC-IP des appareils
			 connectés au réseau
	Return : lstDev, liste des tuples MAC-IP des appareils connectés au réseau
    """
    lstDev = []
    conf.verb = 0 #Fait à ce que Scapy print moins d'infos pour plus de vitesse

    #Envoie des requêtes ARP dans la range locale et 
    ans, unans = srp(Ether(dst="ff:ff:ff:ff:ff:ff") / ARP(pdst=iprange), timeout=2, iface=iface, inter=0.1)
    for snd, rcv in ans:
        lstDev.append((rcv.sprintf(r"%Ether.src%"), rcv.sprintf(r"%ARP.psrc%"))) #Renvoie la source MAC et IP
    return lstDev
